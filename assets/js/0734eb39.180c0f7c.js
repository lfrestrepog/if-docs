"use strict";(self.webpackChunkgreen_software_training=self.webpackChunkgreen_software_training||[]).push([[939],{4137:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),c=r,m=d["".concat(l,".").concat(c)]||d[c]||f[c]||o;return n?i.createElement(m,a(a({ref:t},p),{},{components:n})):i.createElement(m,a({ref:t},p))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var u=2;u<o;u++)a[u]=n[u];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6293:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>f,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var i=n(7462),r=(n(7294),n(4137));const o={sidebar_position:5},a="How to compare files with `if-diff`",s={unversionedId:"users/how-to-compare-files-with-if-diff",id:"users/how-to-compare-files-with-if-diff",title:"How to compare files with `if-diff`",description:"if-diff is a command line tool that allows you to compare two if-run output files. They either match according to if-diff's matching rules, or they don't. If they match, then if-diff returns a simple success response. If the differ, then if-diff returns a report of the differences it finds.",source:"@site/docs/users/how-to-compare-files-with-if-diff.md",sourceDirName:"users",slug:"/users/how-to-compare-files-with-if-diff",permalink:"/users/how-to-compare-files-with-if-diff",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/if-docs/edit/master/docs/users/how-to-compare-files-with-if-diff.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"How to write a manifest file",permalink:"/users/how-to-write-manifests"},next:{title:"How to export to CSV",permalink:"/users/how-to-export-to-csv"}},l={},u=[{value:"Why is this useful?",id:"why-is-this-useful",level:2},{value:"Example: output verification",id:"example-output-verification",level:2},{value:"Example: debugging",id:"example-debugging",level:2}],p={toc:u};function f(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-compare-files-with-if-diff"},"How to compare files with ",(0,r.kt)("inlineCode",{parentName:"h1"},"if-diff")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," is a command line tool that allows you to compare two ",(0,r.kt)("inlineCode",{parentName:"p"},"if-run")," output files. They either match according to ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff"),"'s matching rules, or they don't. If they match, then ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," returns a simple success response. If the differ, then ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," returns a report of the differences it finds."),(0,r.kt)("h2",{id:"why-is-this-useful"},"Why is this useful?"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," can be used to verify that a given output file was correctly executed and that it was not tampered with after it was computed. Imagine you received an output file from someone, reporting their carbon expenditure. It is better to verify than trust this person's report, so you simply delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"outputs")," block from the file (creating a manifest), run it through ",(0,r.kt)("inlineCode",{parentName:"p"},"if-run")," and compare the output to the original file you received. All being well, the two files are identical. if not, you can see exactly where the differences are."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," can also be used for debugging your own files. Maybe you have some large manifest files in development and have accidentally introduced some changes that you are now struggling to identify, but are leading to different ",(0,r.kt)("inlineCode",{parentName:"p"},"if-run")," outcomes. ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," can quickly scan your two files and tell you where the differences are so you can get back in sync."),(0,r.kt)("h2",{id:"example-output-verification"},"Example: output verification"),(0,r.kt)("p",null,"Let's say someone provides you with this output file, ",(0,r.kt)("inlineCode",{parentName:"p"},"given-output-file.yml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"name: sum\ndescription: successful path\ntags:\ninitialize:\n  outputs: ['yaml']\n  plugins:\n    sum:\n      method: Sum\n      path: 'builtin'\n      global-config:\n        input-parameters: ['cpu/energy', 'network/energy']\n        output-parameter: 'energy'\ntree:\n  children:\n    child:\n      pipeline:\n        - sum\n      config:\n        sum:\n      inputs:\n        - timestamp: 2023-08-06T00:00\n          duration: 3600\n          cpu/energy: 0.001\n          network/energy: 0.001\n      outputs:\n        - timestamp: 2023-08-06T00:00\n          duration: 3600\n          cpu/energy: 0.001\n          network/energy: 0.001\n          energy: 0.0005\n")),(0,r.kt)("p",null,"This manifest simply sums two components, ",(0,r.kt)("inlineCode",{parentName:"p"},"cpu/energy")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"network/energy")," and assigns the result to ",(0,r.kt)("inlineCode",{parentName:"p"},"energy")," in the outputs array. You receive this file and feel like something's not quite right. So you delete the outputs block to create ",(0,r.kt)("inlineCode",{parentName:"p"},"test-manifest.yml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"name: sum\ndescription: successful path\ntags:\ninitialize:\n  outputs: ['yaml']\n  plugins:\n    sum:\n      method: Sum\n      path: '@grnsft/if-plugins'\n      global-config:\n        input-parameters: ['cpu/energy', 'network/energy']\n        output-parameter: 'energy'\ntree:\n  children:\n    child:\n      pipeline:\n        - sum\n      config:\n        sum:\n      inputs:\n        - timestamp: 2023-08-06T00:00\n          duration: 3600\n          cpu/energy: 0.001\n          network/energy: 0.001\n")),(0,r.kt)("p",null,"Now you want to ",(0,r.kt)("em",{parentName:"p"},"run")," the manifest through ",(0,r.kt)("inlineCode",{parentName:"p"},"if-run")," and compare the result to the given output file. You can do this by piping the result of ",(0,r.kt)("inlineCode",{parentName:"p"},"if-run")," directly into ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"if-run -m test-manifest.yml | if-diff --target given-output-file.yml\n")),(0,r.kt)("p",null,"The result is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"Files do not match!\ntree.children.child[0].energy\nsource: 0.002\ntarget:  0.0005\n")),(0,r.kt)("p",null,"Uh oh. It seems there has been some mistake or tampering with the outputs in ",(0,r.kt)("inlineCode",{parentName:"p"},"given-output-file.yml"),". The right result of summing ",(0,r.kt)("inlineCode",{parentName:"p"},"cpu/energy")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"network/energy")," is 0.002, but they reported 0.0005. You can now query that result with the sender and ask them to fix it."),(0,r.kt)("p",null,"Obviously, this is an arbitrary, simplified example, but ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," enables you to do this kind of output verification on very complex manifests where errors are harder to spot by eye and to do it programmatically over large numbers of files."),(0,r.kt)("h2",{id:"example-debugging"},"Example: debugging"),(0,r.kt)("p",null,"Imagine you developed a manifest that was giving you a consistent result, but now when you run it your result is different and you are not sure why. Maybe one of your colleagues changed something and forgot to tell you, maybe you accidentally inserted or removed something while you were working."),(0,r.kt)("p",null,"You could revert to an archived version, but you moved all the components around into a structure you prefer! ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," has you covered. It will step through the files identifying all the functional differences between the files to help you identify the problematic one(s)."),(0,r.kt)("p",null,"You have ",(0,r.kt)("inlineCode",{parentName:"p"},"original-manifest.yml")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"new-manifest.yml"),". Pass them to ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"if-diff --source original-manifest.yml --target new-manifest.yml\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," will report each difference it finds. You can fix the difference and run ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," again until you get a success response - since ",(0,r.kt)("inlineCode",{parentName:"p"},"if-diff")," ignores positional differences and only considers differences in ",(0,r.kt)("inlineCode",{parentName:"p"},"context")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"tree")," keys and values, your two manifests will run identically even though you persist your tree reorganization."))}f.isMDXComponent=!0}}]);